---
title: "Predictive ability in meat quality traits"
author: "Belcy Karine Angarita Barajas"
date: "21/09/2020"
output: html_document
---


### 1. Predictive ability meat quality and carcass traits 

The statistical model fitted for each meat quality and carcass trait was: 

$\mathbf{Y= X \beta + Zu +e}$

Using 3 different relationship matrices, the genomic relationship matrix $\mathbf{G_{ibs}}$ computed as $VanRaden\ (2008)$ method 1,the genomic relationship matrix $\mathbf{G_{ibd}}$ computed as $Han\ and\ Abney\ (2011)$ and the additive relationship matrix $\mathbf{A_{22}}$.

To calculate the $predictive\ ability$, we used the Pearson correlation coefficient between predicted and observed phenotype $\hat{r}(y,\hat{y})$ obtained by means of 5-fold cross-validation.  

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(kableExtra)

rm(list=ls())
setwd("~/../../Volumes/Drive/Github_heritability_predictability_Meat_Traits//")

# Result by replicate
ibs<-read.table("resu_corval_Gibs")
Amat<-read.table("resu_corval_A")
ibd2<-read.table("resu_corval_Gibd")


# 1. Correlation by replicate for each lesion count trait 
colnames(ibs)<-c("replicate","cor_y_yhat_Gvr","lc.trait")
colnames(Amat)<-c("replicate","cor_y_yhat_A22","lc.trait")
colnames(ibd2)<-c("replicate","cor_y_yhat_Ghya","lc.trait")

ibs<-select(ibs, replicate, lc.trait, cor_y_yhat_Gvr)%>%arrange(lc.trait) 
Amat<-select(Amat, replicate, lc.trait, cor_y_yhat_A22)%>%arrange(lc.trait)
ibd2<-select(ibd2, replicate, lc.trait, cor_y_yhat_Ghya)%>%arrange(lc.trait) 

# 2. Data correlation estimated
validres<-Amat%>%left_join(ibs)%>%left_join(ibd2)
validres<-validres%>%filter(!is.na(cor_y_yhat_Gvr),!is.na(cor_y_yhat_Ghya))

rp<-validres%>%arrange(replicate)%>%count(replicate)%>%filter(n==20)
validres<-rp%>%left_join(validres)
validres<-validres%>%select(replicate,lc.trait:cor_y_yhat_Ghya)
winrepli<-function(x){
  winner<-vector()
  loser<-vector()
  for(i in 1:nrow(x)){
    winner[i]<-which.max(x[i,3:5])
    loser[i]<-which.min(x[i,3:5])
  }
  winerMat<-cbind(winner,loser)
  return(winerMat)
}
s<-winrepli(validres)
validres<-cbind(validres,s)

for (i in 1:length(validres$winner)) {
  if (validres$winner[i]==1) {validres$winner[i]<-"A"}
  if (validres$winner[i]==2) {validres$winner[i]<-"Gvr"}
  if (validres$winner[i]==3) {validres$winner[i]<-"Ghya"}
  }

for (i in 1:length(validres$loser)) {
  if (validres$loser[i]==1) {validres$loser[i]<-"A"}
  if (validres$loser[i]==2) {validres$loser[i]<-"Gvr"}
  if (validres$loser[i]==3) {validres$loser[i]<-"Ghya"}
}

# 3. list by trait results of correlation y,yhat replicate
trt<-as.vector(names(table(validres$lc.trait)))
result.cor.traits<-list()
for (i in 1:length(trt)) {
  result.cor.traits[[i]]<-filter(validres, lc.trait==trt[i])%>%select(replicate,cor_y_yhat_A22,
                                                          cor_y_yhat_Gvr, cor_y_yhat_Ghya,
                                                          winner, loser)
  names(result.cor.traits)[i]<-trt[i]
}

mt<-validres%>%group_by(lc.trait)%>%
  summarise_at(vars(cor_y_yhat_A22,cor_y_yhat_Gvr,cor_y_yhat_Ghya),funs(mean,sd))%>%ungroup()
mt<-mt%>%
  transmute(Trait=lc.trait,nrep=nrow(rp),
         A=cor_y_yhat_A22_mean,A.sd=cor_y_yhat_A22_sd,
         Gvr=cor_y_yhat_Gvr_mean,Gvr.sd=cor_y_yhat_Gvr_sd,
         Gibd=cor_y_yhat_Ghya_mean,Gibd.sd=cor_y_yhat_Ghya_sd)

colnames(mt)<-c("Trait", "nrep","A22","sd","Gibs","sd", "Gibd","sd")
winner<-as.matrix(apply(mt[,c(3,5,7)],1, function(x)which.max(x)))
colnames(winner)<-"Maximun value"
for (i in 1:nrow(winner)) {
  if(winner[i]==1){winner[i]<-"A"}
  if(winner[i]==2){winner[i]<-"Gibs"}
  if(winner[i]==3){winner[i]<-"Gibd"}
}
r1<-cbind(mt,winner)

```

```{r}
kable(r1)%>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),full_width = F, 
               position = "center") %>%
  add_header_above(c(" ", " ","correlation y vs yhat" = 6," "), italic = T,bold = T)
  

```
```

